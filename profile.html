<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Tracker - Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        .bg-primary-gradient {
            background-image: linear-gradient(to right, #ec4899, #d946ef);
        }
        /* Modal styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
        }
        /* Custom progress bar colors for macros */
        .macro-progress-protein { background-color: #3b82f6; /* Blue-500 */ }
        .macro-progress-carbs { background-color: #f97316; /* Orange-500 */ }
        .macro-progress-fat { background-color: #facc15; /* Yellow-400 */ }
        
        /* Addition for consistency in the bottom nav bar */
        .nav-item.active {
            color: #ec4899; /* Pink-500 */
            font-weight: 700; /* bold */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden relative h-[800px]">
        
        <div class="relative flex flex-col h-full bg-gray-50">
            <div class="absolute top-0 -left-16 w-72 h-72 bg-pink-300 rounded-full opacity-30 filter blur-3xl"></div>
            <div class="absolute bottom-0 -right-16 w-72 h-72 bg-purple-300 rounded-full opacity-30 filter blur-3xl"></div>
            
            <div class="relative z-10 flex-grow overflow-y-auto pb-28">
                
                <div class="text-center pt-12 pb-6 px-6">
                    <img id="user-avatar" src="https://i.pravatar.cc/150?u=user-profile" alt="User Avatar" class="w-24 h-24 rounded-full object-cover mx-auto mb-4 border-4 border-white shadow-lg">
                    <h2 id="user-name" class="font-bold text-2xl text-gray-900">Your Name</h2>
                    <p id="user-motto" class="text-sm text-gray-500">"Consistency is key!"</p>
                </div>

                <div class="px-6 mb-8 grid grid-cols-3 text-center divide-x divide-gray-200">
                    <div>
                        <p id="days-tracked" class="font-bold text-lg">125</p>
                        <p class="text-xs text-gray-500">Days Tracked</p>
                    </div>
                    <div>
                        <p id="badges-count" class="font-bold text-lg">5</p>
                        <p class="text-xs text-gray-500">Badges</p>
                    </div>
                    <div>
                        <p id="friends-count" class="font-bold text-lg">15</p>
                        <p class="text-xs text-gray-500">Friends</p>
                    </div>
                </div>

                <div class="px-6 mb-8">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Today's Goals</h3>
                        <button id="adjust-goal-btn" class="text-xs font-semibold text-pink-500 hover:text-pink-700">Adjust Goal</button>
                    </div>
                    <div class="bg-white/60 rounded-xl p-4 space-y-4 shadow-sm">
                        <div>
                            <div class="flex justify-between mb-1 text-sm">
                                <span class="font-semibold text-gray-700">Calories</span>
                                <span id="calories-progress-text" class="text-gray-600">1500 / 2000 kcal</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="calories-progress-bar" class="bg-primary-gradient h-2.5 rounded-full" style="width: 75%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3 pt-2">
                            <div class="flex flex-col items-start">
                                <span class="text-sm font-semibold text-gray-700 mb-1">Protein</span>
                                <div class="w-full bg-gray-200 rounded-full h-1.5 mb-1">
                                    <div id="protein-progress-bar" class="macro-progress-protein h-1.5 rounded-full" style="width: 75%"></div>
                                </div>
                                <span id="protein-progress-text" class="text-xs text-gray-600">90/120g</span>
                            </div>
                             <div class="flex flex-col items-start">
                                <span class="text-sm font-semibold text-gray-700 mb-1">Carbs</span>
                                <div class="w-full bg-gray-200 rounded-full h-1.5 mb-1">
                                    <div id="carbs-progress-bar" class="macro-progress-carbs h-1.5 rounded-full" style="width: 72%"></div>
                                </div>
                                <span id="carbs-progress-text" class="text-xs text-gray-600">180/250g</span>
                            </div>
                             <div class="flex flex-col items-start">
                                <span class="text-sm font-semibold text-gray-700 mb-1">Fat</span>
                                <div class="w-full bg-gray-200 rounded-full h-1.5 mb-1">
                                    <div id="fat-progress-bar" class="macro-progress-fat h-1.5 rounded-full" style="width: 72%"></div>
                                </div>
                                <span id="fat-progress-text" class="text-xs text-gray-600">40/55g</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-6 mb-8">
                    <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Weight Progress (30d)</h3>
                    <div class="bg-white/60 rounded-xl p-4 shadow-sm">
                        <canvas id="weight-chart-canvas"></canvas>
                    </div>
                </div>

                <div class="px-6 space-y-3">
    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider">Preferences</h3>
    
    <div class="bg-white/60 rounded-xl p-2 space-y-1 shadow-sm">
        <a href="reminders.html" class="flex items-center p-3 hover:bg-gray-200/50 rounded-lg transition-colors">
            <span class="text-lg">üîî</span>
            <span class="ml-4 font-semibold text-gray-700">Reminders & Notifications</span>
            <span class="ml-auto text-gray-400">&gt;</span>
        </a>
        <a href="routines.html" class="flex items-center p-3 hover:bg-gray-200/50 rounded-lg transition-colors">
            <span class="text-lg">üîÑ</span>
            <span class="ml-4 font-semibold text-gray-700">Routine Meals</span>
            <span class="ml-auto text-gray-400">&gt;</span>
        </a>
    </div>

    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider pt-2">More</h3>

    <div class="bg-white/60 rounded-xl p-2 space-y-1 shadow-sm">
        <a href="settings.html" class="flex items-center p-3 hover:bg-gray-200/50 rounded-lg transition-colors">
            <span class="text-lg">‚öôÔ∏è</span>
            <span class="ml-4 font-semibold text-gray-700">Account Settings</span>
            <span class="ml-auto text-gray-400">&gt;</span>
        </a>
    </div>

    <div class="bg-white/50 rounded-xl p-2 mt-4 shadow-sm">
        <a id="logout-button" href="#" class="flex items-center p-3 text-red-500 hover:bg-red-100/50 rounded-lg transition-colors">
            <span class="text-lg">üö™</span>
            <span class="ml-4 font-semibold">Log Out</span>
        </a>
    </div>
</div>

            </div>
        </div>

        <div id="emblem-menu" class="hidden">
        </div>
        
        <nav class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[95%] max-w-sm z-20 glass-card grid grid-cols-5 items-center p-2 rounded-2xl shadow-lg">
            <a href="community.html" class="nav-item flex flex-col items-center text-gray-600 py-1 hover:text-pink-500 transition-colors">
                <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283-.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                <span class="text-xs">Community</span>
            </a>
            <a href="diary.html" class="nav-item flex flex-col items-center text-gray-600 py-1 hover:text-pink-500 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mb-1 rotate-180" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 3h4"></path><path d="M7 3v12"></path><path d="M4 15h6v3a3 3 0 0 1 -6 0v-3z"></path><path d="M14 21v-3a3 3 0 0 1 6 0v3"></path><path d="M17 21v-18"></path></svg>
                <span class="text-xs">Diary</span>
            </a>
            <button id="plus-button" class="bg-primary-gradient text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg -mt-6 transform hover:scale-110 transition-transform">
                <svg class="w-8 h-8 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
            </button>
            <a href="marketplace.html" class="nav-item flex flex-col items-center text-gray-600 py-1 hover:text-pink-500 transition-colors">
                <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                <span class="text-xs">Marketplace</span>
            </a>
            <a href="profile.html" class="nav-item flex flex-col items-center text-pink-500 font-bold py-1 nav-item active">
                <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span class="text-xs">Profile</span>
            </a>
        </nav>
    </div>

    <div id="goal-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div id="modal-overlay" class="absolute inset-0 modal-overlay"></div>
        <div class="relative bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 space-y-4">
            <h3 class="text-lg font-bold text-gray-800">Adjust Your Goals</h3>
            <div>
                <label for="goal-calories" class="block text-sm font-medium text-gray-700">Calories (kcal)</label>
                <input type="number" id="goal-calories" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm p-2">
            </div>
            <div class="grid grid-cols-3 gap-4">
                 <div>
                    <label for="goal-protein" class="block text-sm font-medium text-gray-700">Protein (g)</label>
                    <input type="number" id="goal-protein" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm p-2">
                </div>
                 <div>
                    <label for="goal-carbs" class="block text-sm font-medium text-gray-700">Carbs (g)</label>
                    <input type="number" id="goal-carbs" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm p-2">
                </div>
                 <div>
                    <label for="goal-fat" class="block text-sm font-medium text-gray-700">Fat (g)</label>
                    <input type="number" id="goal-fat" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500 sm:text-sm p-2">
                </div>
            </div>
            <div class="flex justify-end space-x-3 pt-4">
                <button id="cancel-goal-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">Cancel</button>
                <button id="save-goal-btn" class="px-4 py-2 text-sm font-medium text-white bg-primary-gradient rounded-lg hover:opacity-90">Save Changes</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. USER DATA SIMULATION ---
        let userProfile = JSON.parse(localStorage.getItem('userProfileData'));

        if (!userProfile) {
            userProfile = {
                name: 'Jane Doe',
                motto: 'One meal at a time!',
                avatarUrl: 'https://i.pravatar.cc/150?u=jane-doe',
                stats: {
                    daysTracked: 125,
                    badges: 5,
                    friends: 15
                },
                currentIntake: { // Example intake for today
                    calories: 1500,
                    protein: 90,
                    carbs: 180,
                    fat: 40
                },
                goals: { // Daily goals
                    calories: 2000,
                    protein: 120,
                    carbs: 250,
                    fat: 55
                },
                weightData: { // Data for the weight chart
                    labels: ['Aug 1', 'Aug 8', 'Aug 15', 'Aug 22', 'Aug 29', 'Sep 5'],
                    weights: [70, 69.5, 69.8, 69, 68.5, 68]
                }
            };
            localStorage.setItem('userProfileData', JSON.stringify(userProfile));
        }


        // --- 2. FUNCTION TO RENDER DATA TO THE UI ---
        const renderProfileData = () => {
            const profile = JSON.parse(localStorage.getItem('userProfileData'));
            
            // Header
            document.getElementById('user-name').textContent = profile.name;
            document.getElementById('user-motto').textContent = `"${profile.motto}"`;
            document.getElementById('user-avatar').src = profile.avatarUrl;
            
            // Stats
            document.getElementById('days-tracked').textContent = profile.stats.daysTracked;
            document.getElementById('badges-count').textContent = profile.stats.badges;
            document.getElementById('friends-count').textContent = profile.stats.friends;

            // Progress Bars & Text
            const { currentIntake, goals } = profile;
            
            // Calories
            document.getElementById('calories-progress-text').textContent = `${currentIntake.calories} / ${goals.calories} kcal`;
            let calPercent = Math.min((currentIntake.calories / goals.calories) * 100, 100);
            document.getElementById('calories-progress-bar').style.width = `${calPercent}%`;

            // Protein
            document.getElementById('protein-progress-text').textContent = `${currentIntake.protein} / ${goals.protein}g`;
            let proPercent = Math.min((currentIntake.protein / goals.protein) * 100, 100);
            document.getElementById('protein-progress-bar').style.width = `${proPercent}%`;

            // Carbs
            document.getElementById('carbs-progress-text').textContent = `${currentIntake.carbs} / ${goals.carbs}g`;
            let carbPercent = Math.min((currentIntake.carbs / goals.carbs) * 100, 100);
            document.getElementById('carbs-progress-bar').style.width = `${carbPercent}%`;

            // Fat
            document.getElementById('fat-progress-text').textContent = `${currentIntake.fat} / ${goals.fat}g`;
            let fatPercent = Math.min((currentIntake.fat / goals.fat) * 100, 100);
            document.getElementById('fat-progress-bar').style.width = `${fatPercent}%`;
        };


        // --- 3. FUNCTION TO RENDER THE CHART ---
        let weightChartInstance = null; // Variable to hold the chart instance

        const renderWeightChart = () => {
            const { weightData } = JSON.parse(localStorage.getItem('userProfileData'));
            const ctx = document.getElementById('weight-chart-canvas').getContext('2d');
            
            // Destroy existing chart if it exists
            if (weightChartInstance) {
                weightChartInstance.destroy();
            }

            weightChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weightData.labels,
                    datasets: [{
                        label: 'Weight (kg)',
                        data: weightData.weights,
                        borderColor: '#ec4899', // Pink-500
                        backgroundColor: 'rgba(236, 72, 153, 0.1)', // Light pink fill
                        fill: true,
                        tension: 0.3, // Smoother line
                        pointBackgroundColor: '#d946ef', // Purple-500
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#d946ef'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Allow custom sizing if parent has height
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.dataset.label}: ${context.raw}kg`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false } // No vertical grid lines
                        },
                        y: { 
                            beginAtZero: false,
                            grid: { color: 'rgba(0,0,0,0.05)' } // Light horizontal grid lines
                        }
                    }
                }
            });
        };


        // --- 4. MODAL LOGIC FOR ADJUSTING GOALS ---
        const modal = document.getElementById('goal-modal');
        const adjustBtn = document.getElementById('adjust-goal-btn');
        const cancelBtn = document.getElementById('cancel-goal-btn');
        const saveBtn = document.getElementById('save-goal-btn');
        const overlay = document.getElementById('modal-overlay');

        const openModal = () => {
            // Fill inputs with the current goal values
            const { goals } = JSON.parse(localStorage.getItem('userProfileData'));
            document.getElementById('goal-calories').value = goals.calories;
            document.getElementById('goal-protein').value = goals.protein;
            document.getElementById('goal-carbs').value = goals.carbs;
            document.getElementById('goal-fat').value = goals.fat;
            modal.classList.remove('hidden');
        };

        const closeModal = () => {
            modal.classList.add('hidden');
        };

        adjustBtn.addEventListener('click', openModal);
        cancelBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        saveBtn.addEventListener('click', () => {
            let currentProfile = JSON.parse(localStorage.getItem('userProfileData'));
            
            currentProfile.goals.calories = parseInt(document.getElementById('goal-calories').value) || 0;
            currentProfile.goals.protein = parseInt(document.getElementById('goal-protein').value) || 0;
            currentProfile.goals.carbs = parseInt(document.getElementById('goal-carbs').value) || 0;
            currentProfile.goals.fat = parseInt(document.getElementById('goal-fat').value) || 0;

            localStorage.setItem('userProfileData', JSON.stringify(currentProfile));
            
            renderProfileData();
            closeModal();
        });


        // --- 5. LOGOUT LOGIC ---
        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
            logoutButton.addEventListener('click', (event) => {
                event.preventDefault();
                if (confirm('Are you sure you want to log out?')) {
                    localStorage.clear();
                    window.location.href = 'index.html'; // Adjust to your login page
                }
            });
        }

        // --- INITIALIZE ON PAGE LOAD ---
        renderProfileData();
        renderWeightChart();
    });
    </script>
</body>
</html>